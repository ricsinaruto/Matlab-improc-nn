function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 24-Mar-2017 14:38:34.
% 
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 4xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-10;-10;-10;-10];
x1_step1.gain = [0.1;0.1;0.1;0.1];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.9995193631264452;2.7458854732515743;2.9483173790212662;1.9513781912849537;-1.9485561580003676;0.77837051701470295;0.85219793389463983;0.7853359726562531;0.4997226624068119;-0.47576431390939733;0.39389763696425029;1.3504267579293674;0.527735167329209;1.8503623543881447;-0.75778467352519596;3.7284829012497624];
IW1_1 = [-1.7839749029059768 0.54197023597174554 0.71269098815908694 -1.7399217760966788;-1.8394229478029502 1.7876379096864801 -0.16572256580444492 -0.056248061558074193;-1.5893550928743654 -1.0396682996298567 -0.054549133239943585 0.6957159898886196;-1.5772475710519989 -1.3474624511119779 1.6129561931694429 0.23471812752488247;1.6068853192137458 1.3844994304328191 -0.75984579089227522 0.92064898452741473;-1.9568457999294455 -1.6303978270512802 -0.12272977384604103 -1.2737902035131379;-3.2329045598362387 -1.0902546364067671 0.05914058432981037 1.1278238835026193;-6.5601225623536994 1.1261566087094794 -0.65981243401232625 1.4878512577855847;0.095497342573662145 11.132061465705688 -0.039468250831930465 -1.470568243611214;-0.031531887173386577 11.909281777135901 -1.4503083312678646 -0.10061028797720975;2.8415263451230035 0.68821038511331778 -1.0202564550152342 0.40224944093748999;0.36598851272970379 0.33153172034771494 1.4353047427840819 1.7311807982833873;1.1892420750637898 -2.9053763181223826 0.18545442872339793 0.2743716623078854;0.17782479008420327 0.44909780848889924 0.78293385085563039 2.7417107657431221;0.1203421346480447 0.071978428828291058 2.6117342595493414 -2.6959246364785399;0.92453509855652694 -0.069953430242967171 0.17697164304638605 -1.4883246029721657];

% Layer 2
b2 = [1.3623185850353492;2.1560731456366393;-1.5483831024311436;1.2792998847624628;-0.6929144553003872;1.5761324788462086;0.48883529235050704;0.023560536149336949;0.62832149212017563;0.045968342045998339;0.5378460710228713;-0.74232380106767448;-0.82207170145371911;-1.5376048258302233;-0.062312853120321629;-1.3657882380388944];
LW2_1 = [-0.54225369614986607 0.36236550517074867 -1.076397473748868 -0.11521625829963671 0.30619559413613112 -0.23666833635768128 -1.1647346959461211 -1.8199043247769455 2.4398283313855198 -2.895089566793644 0.36154515002054716 -0.48695283965457031 -0.32240807363845303 0.37248644744582293 -0.57239472734784691 0.29117103308887565;-0.092101987087842022 0.13506853967486365 0.80296665120881416 0.16393654821500939 -0.99971488459276525 -0.048004919925818484 -0.31291224130925244 -1.1818486942954125 -3.5961849800472656 1.4152013624359008 -0.00040728925718239682 -0.045447287826961211 0.66312704155760549 -0.011119398301464651 1.2991650539461703 -0.21097259062761595;-0.23363329626123255 -0.41154481455370295 -0.28930167781137406 -0.25520154899332281 0.70794689143795442 0.26375748222408091 0.62821051902397129 -0.050362375054023828 -0.070949822462962123 0.41477170484407028 -0.03866925785077073 -0.86995463099312231 -0.039609933348974849 0.26992191830923801 -0.39574101638960929 -0.32460402411172878;-0.169600023794268 0.71198369201249911 0.10923036362373255 0.11968872644262554 -0.66638641268786214 -0.62084237901044692 -0.20399273552101208 -0.2811070855436425 -0.23078095099512788 -0.11137250911132747 0.027369363635681501 0.67332433972539496 -0.21085599016769518 -0.22735066560551687 0.17733877284906757 0.74500635434378781;0.1641379375723383 -0.59976449637543683 -0.2451106129116 -0.62976480277729974 -0.35540202381924996 0.13815256625850916 -1.3516782172727715 -2.5346926634344267 -0.28205123734324544 -0.67521755906359149 0.84461590046740209 0.58775177355806263 0.89600253076963576 0.98840530998895593 0.85788907566184169 0.1992988554382385;0.32096581044728462 0.83356717630334509 0.81497683962479361 -0.054981024585081598 -0.93646001646882659 0.06681944680281926 -0.64454505616304159 -1.3721933254494409 -2.9122744296552772 3.2863514217369425 -0.22909171256728456 0.24928600776591125 -0.0079758877472467966 -0.39619253713893404 0.90534805342395863 0.95710716911536009;-0.10186412799714788 0.27309528984925607 0.30502866014691826 0.362668296929405 0.19559469834695636 -0.51136170431915662 -0.20519983659966218 -0.6997383430239541 -1.0116635830692933 1.6276958372870283 0.46948423192740746 0.529859114943664 0.58354873881236169 -0.19403979732614021 -0.55334218173249983 0.4508265051067083;-0.65694740804910723 0.084127858486150037 0.54171697722088985 -0.57791395644071641 -0.61666932017482678 0.3864296268444537 0.47560875909361616 -0.30617331389365232 0.18964376579900152 0.1803678853819371 0.17152803800451971 -0.42719131173420422 -0.061208270972185445 0.58159297467718341 -0.33809206178192125 0.36049325925984144;0.89027846524820542 0.86731113672373727 0.68926941329693792 -0.44132405206839054 -0.41845577323087518 0.28344215042731624 0.71472898422277531 0.68085544129464148 -3.8376670678220557 3.577189030996109 -0.25918811794669666 -0.1158771662148126 -0.1918397524059989 0.24640316773876381 0.35995060883359214 -0.28388936255606689;0.0011272405762022062 0.40968760800079934 0.33699305537360219 -0.44160033265389947 0.40383530924942784 -0.33516729918850036 0.85470837160499169 0.87833153629495286 -0.36531445125729184 -0.99555009945459805 -0.3821084964749259 -0.2188285633327631 -0.34236777674313879 0.024025281178313908 0.18348292167954378 -0.19385393370234127;0.43422418911151556 0.21065356726803525 0.050614332160719464 0.011829807220924918 0.43056724232220528 0.5700207283634634 0.40974517067577398 -0.6130140006681748 0.12415089882648907 0.53527206588602039 -0.21078527539026179 0.33953044252372966 0.40292968542625152 -0.25194151831634515 -0.71310388631524868 0.44896060078843986;-0.074684122176680745 0.18285723813297292 0.058878703038347364 0.60022017562454533 -0.64679459748862433 0.060199892061656025 0.55494896951935502 0.87773747644968214 -0.6427970318403422 -0.7570170689047635 -0.90859774370761259 -0.0493959399501364 -0.57469892739042616 0.039819558557076855 -0.36695718980333342 -0.44988616583946101;-0.41483453735587744 0.14024347248699065 0.14831230504020471 0.68811913547606796 -0.76969251594231947 0.55590216520567803 1.691015736397175 1.5464820942110469 -1.4448824109528322 1.8982505465985533 -0.66180712085835491 -0.85636791161999981 -0.46132847059727272 -0.40248622860509942 -0.98576174534615102 -0.20760507222999722;-0.5761788044570495 0.16869024389326873 0.17027165850054737 0.63990579606417419 0.19044661802669827 0.10068365682195481 -0.34368051693474322 0.11161790461477238 1.4028203521210354 -2.1588295909351074 -0.14632372758287379 0.42032272533098003 -0.43499556950609852 -0.54171359657809581 -0.52392774994135627 -0.4725483331008215;-1.3312817742781247 -1.2039226885774261 -1.1886520537002256 -0.37362530276620259 0.35724568542833807 -0.69589115623836195 -0.65210988765655731 2.0511926575789765 3.686168899455446 -4.4037339278875409 -0.49591080313497365 0.32412921305024572 -0.45974457217679027 -0.200074691453241 -1.1353616176068702 -1.4593317035994526;0.16066073936108574 0.8672738914262933 0.19922713503764747 0.58725485986721793 -0.55643521510917193 -0.35700900455128448 0.11170266813608967 -1.2006828742089428 -1.2045322585295428 -0.55965965936634132 0.37194088597865949 0.1050194656016917 0.91406419305696662 0.1316247379430627 0.43307739933468198 0.079172852981383005];

% Layer 3
b3 = -0.87348444997497299;
LW3_2 = [4.0624937842122026 -4.3900425021095764 1.8691390254884783 -1.4666581021533267 -3.0458411814888464 -5.004438343830568 -2.0083018881414465 -0.24425797399763893 -5.3459723544105229 1.2239688712902195 -0.16422411994964006 1.4011102078862721 -2.887874571077238 2.8124206293183294 6.7113225201046358 -1.5592378361008274];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = logsig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Output 1
    Y{1,ts} = a3;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n,~)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end
