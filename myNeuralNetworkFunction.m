function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 16-Mar-2017 14:57:31.
% 
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 4xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-10;-10;-10;-10];
x1_step1.gain = [0.1;0.1;0.1;0.1];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.39196322049321097;0.40442736467823298;0.40413208644679416;0.37837850494844211;-0.0021761250980716351;0.032545647807265127;-0.19111470336590985;-0.26894318724340577;0.051401071632246054;-0.27546825585262541;0.27662137605893289;-0.23053258993433912;0.37452919233640364;0.40256461034427193;0.036285892227036043;-0.40204843532009776];
IW1_1 = [-0.029254636073097036 0.0012852640588979845 0.034371698695474025 -0.013973002376324803;-0.028946103124142499 -0.00021113907069698944 0.031764999180892033 -0.01198908975110307;-0.028879131643538634 0.0075323287703881444 0.031789789445298221 -0.012813062857173858;-0.030512629054207159 -0.0042725954143255276 0.032133737207574495 -0.010851518172357116;-0.0047969355516021012 -0.036463415535199682 0.0065119981505860191 0.0023632285864045467;-0.020823069163266858 0.046546038078638718 0.0014772306850849241 0.00041945723715408026;0.028722218814745903 0.019649935991416609 -0.028159040957454175 0.0085173650736140808;0.33282430828497372 -2.6829530530437116 -0.12200660633503126 0.39504395858245622;-0.0048383510691822826 0.053874610701383462 -0.00036518341428447201 -0.0026679313217001042;0.029963909283235474 0.028184819566401311 -0.03046273175983473 0.013712155325772165;-0.043685027914070126 -0.004014476680768991 0.055575411863800897 -0.042665927111487596;0.28405114543442089 2.6826807732000733 -0.47809419508752515 0.13552646429618412;-0.049730748780480637 0.0056902323240389761 0.036223008122284059 -0.020724267356702349;-0.03255316091472301 -0.0088535372734314458 0.030651952806851086 -0.014524928892165397;3.3621122514558783e-06 -0.077490572390501875 0.015681920292988195 -0.0048037960215821423;0.030669575661740577 -0.0030989555500361117 -0.031197515571829443 0.013593269397289796];

% Layer 2
b2 = [-0.27991305577922826;-0.28665748944147201;0.19744816920398192;-0.2507959663688582;0.3093236602750874;0.29922947562973917;0.30744040635656728;-0.2737861110086699;0.23309132367252039;0.27728566415024447;0.27875111486444215;0.27701405357713715;0.27917903554576029;0.27974994539387776;0.28544661054206044;-0.27156502441448371];
LW2_1 = [-0.10795808264751504 -0.1135141708287329 -0.11183839236946563 -0.10250963045324658 0.00070712242695465135 -0.010240010840484782 0.050389261342724589 -0.49805670017858195 -0.013089084529515732 0.072864400227069831 -0.069042165393349675 -0.50830131909936815 -0.097691262310430169 -0.11059556880496312 -0.0067358162689491723 0.11196719426242101;-0.10925664705425893 -0.11471922488435092 -0.1132185162792787 -0.10202409388211439 0.0018696915396471336 0.0034537300707068808 0.053507831212366415 -0.58007641980960212 -0.018675507983033711 0.074997675105200445 -0.080244644355634984 -0.59011225271335899 -0.1096799854991867 -0.11371876025539743 -0.018927985760075459 0.11253383104168869;0.072461597785281828 0.073683679666151178 0.077991542731129307 0.077057232474501414 0.019877742219581176 -0.030674516021981953 -0.054484778095740712 0.42880495189527068 -0.022023922065576719 -0.077938701287893888 0.039616667410886243 0.27325440640486182 0.059102454666198949 0.094314221001384577 0.061034653277682885 -0.074540684448363537;-0.098523465258091136 -0.10166549478534889 -0.099769969766353855 -0.09365548504468596 0.00087717253756841248 -0.0047385157062557956 0.04664214226962056 -0.41085972902895435 -0.013056438999988172 0.065175810211832205 -0.062340673291767554 -0.41882413819321629 -0.086965960999436528 -0.097507709603743956 -0.0078847834944683476 0.10186663915615679;0.11923942595842876 0.12625959617316246 0.12348940566741415 0.11425312650483743 0.0010419790592462845 0.0030914074692190924 -0.058292978879172619 0.59438681953565475 0.016890176665758094 -0.084150561417982758 0.081044850223590703 0.60373638818559405 0.11603540218576433 0.12496765883057018 0.017210916272611641 -0.12433506310923778;0.1176716852738513 0.12296803240638253 0.12109305172354701 0.1093500229649363 -0.00042696055986059695 0.0057840670328243695 -0.060873030430113557 0.54746803091737661 0.016818016828755587 -0.083852793391154909 0.074504135002034497 0.55628108714622893 0.10887749386914854 0.1241190737040594 0.012129583710004877 -0.12330760095728392;0.11822911232840731 0.12613243604580016 0.12443695005313764 0.11329204823478133 0.0023295626015417143 0.0098784957435794195 -0.05979755763666348 0.58601012886849724 0.015463948422498203 -0.082482967944677535 0.076056311596392548 0.59674232911773017 0.10846941740821084 0.12323448229391652 0.011894425281649568 -0.12516953398888964;-0.10678716467873761 -0.11052073877594239 -0.1094341659113711 -0.10410735102939099 -0.00083015762293751753 -0.010046184661616952 0.049705483487645329 -0.4830026538606973 -0.013718918296452989 0.071034825242025729 -0.068538654756752013 -0.49306780874301953 -0.097380012971959695 -0.1097879945397504 -0.0060467502625668728 0.11023457908636773;0.087567382047149908 0.093781671072972028 0.088395037968184056 0.075395994066654176 -0.030191735296679328 0.036337404404991051 -0.028925900952576529 0.32213843988868351 0.056065173496262548 -0.043742168683324686 0.041622908657067428 0.41119328688633244 0.073902315083934994 0.095679193049370836 -0.054160783603280305 -0.090991574493186289;0.1091266304141289 0.1129675215808098 0.1110033015816785 0.10387240132586607 -0.00049662611483892928 0.0095944335363564396 -0.050923113365808445 0.49502334406187332 0.012799931961583522 -0.07413414675678745 0.069451560033171711 0.50503788286522966 0.098171565793065227 0.10909090084651166 0.0066310153156080662 -0.11198934326435482;0.10964619548059704 0.11271069921853946 0.11070616009160257 0.10330821247605322 0.00072800355829543664 0.010165324728583613 -0.051181663193272948 0.49874026682042361 0.014220221487586213 -0.074615228149032417 0.068822511538292594 0.50902378355026134 0.099174634659735417 0.1101797659523628 0.0049119977127038703 -0.11381252516082249;0.10897215840209656 0.11093091870944427 0.11041043828798237 0.10233716154697685 0.00016184786814356223 0.0086377779163466679 -0.051392560854944071 0.49110561456697449 0.012455404036787779 -0.072543649080721445 0.06845823953217238 0.50118808096639933 0.097991327263620157 0.10895516579220828 0.0056267640846017174 -0.1126750216751248;0.10889575159718708 0.11253535934704111 0.11215194786543521 0.10381889959890676 -0.00048737965173244229 0.01031576610886069 -0.051725753510186649 0.4997483499209765 0.013894946342220734 -0.073798472954966512 0.069745881276986069 0.50992539685391836 0.097449780039678094 0.110303630863873 0.0072036473556152504 -0.11379236289723141;0.10864408369262002 0.1120322595501231 0.11243753148801575 0.10364598258702494 0.00062935725086173892 0.008981863228540032 -0.050721256730814832 0.4997048249325784 0.013587643042272123 -0.074152083813085662 0.069650500187293629 0.50991105395068848 0.097585289840000158 0.110089274254407 0.0074136867571158813 -0.11378660437635378;0.11161470338276867 0.11339145131736475 0.11232179311598925 0.10668504516257299 -0.00032469749387256072 0.010285358494280281 -0.051274393577998872 0.51366547015555364 0.015591406056567407 -0.073410469862196043 0.071017252409985673 0.52392096185262416 0.10088648821461778 0.11087232711431069 0.0068914281333125786 -0.11448717375417332;-0.10755289921188492 -0.11206837918927601 -0.11073633297273366 -0.10472206568103223 0.00039513106352024647 -0.0083108215193372758 0.049932397259850853 -0.48271386383952208 -0.014950851665354297 0.072290373582725997 -0.067221239603846183 -0.4926238299996149 -0.098125679487549591 -0.10845116423400497 -0.0053755369600170027 0.11183811051776592];

% Layer 3
b3 = -0.67393935656816339;
LW3_2 = [0.87124853842459238 0.99724103574683975 -0.59139922625586205 0.73517950864456316 -1.0297931889469758 -0.93866836559159839 -1.0120015319566233 0.86538863097046037 -0.64557779101563117 -0.87300330505671031 -0.8759725047307646 -0.87040520993454773 -0.87377903940919743 -0.8757444103766292 -0.90256441201096238 0.86435185977119955];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = logsig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Output 1
    Y{1,ts} = a3;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n,~)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end
