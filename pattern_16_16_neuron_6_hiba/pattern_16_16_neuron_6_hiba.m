function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 07-Mar-2017 19:08:47.
% 
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 4xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-10;-10;-10;-10];
x1_step1.gain = [0.1;0.1;0.1;0.1];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.2072196842340066;2.0206270793555716;-2.0664338515042058;1.2619020061823925;-0.56508387160047191;-0.2378848305411721;-0.5082761517114126;0.23380652229908511;-0.48889600203161637;1.1626708800474777;-0.15867958693213574;0.094108626962346495;-0.58551014190488448;1.9443731465584828;2.2111414044830644;3.3528563347626377];
IW1_1 = [-1.0870868057940835 1.2140972619702266 1.0005274002120643 1.1196095461885684;-0.70425670118589745 2.9249628575250872 0.74124226187468323 -0.54633804094626071;1.2616648287374803 -2.5005493848493305 -0.36995132386600404 0.004858857949846666;-2.0656100902558907 0.24718314646557921 -0.88104193027794198 -1.9972003157520497;0.19853930689800789 -1.4192455907347579 -1.7736695456559572 1.6726457235097874;8.0683396547515951 0.56186111284560747 0.21461055305471802 -1.3393350807580555;-0.37650371235367514 9.2470818746655095 -0.48379491729761748 -0.9197193616763133;0.0035604738556392311 9.9661762128406473 -1.3499051396334119 0.20749870872500858;-0.58063668376303312 -3.8398827610079547 1.6385118738402373 -0.39546597638291658;0.58707220553226025 3.4959010170359539 -1.564625617454539 1.5813368168270723;0.089849982486161287 10.584536442854358 0.21151472717705466 -1.5457211325362381;-2.1635794180724073 -0.6515010891857469 2.3156011858180707 -1.2576345391900019;-2.5282418910083329 2.9840455875536822 1.3648072371571849 0.11863213769430554;1.083308422372637 -1.5649655909328166 1.081749545125603 -1.6885028287665691;1.0585789953858165 1.3256471400702183 -0.017028591245545652 -2.751399475001707;0.68638911373120515 1.1550965795800434 -0.93398316475660936 -1.5907200209684957];

% Layer 2
b2 = [-1.9289393785237374;1.81701323423644;-1.5630946717370127;1.3228371907921157;1.2319715688406743;0.2361833850979346;-0.45593539310874676;0.026174894005983124;-0.13960844531697891;-0.39717568297814093;0.75724099306470516;-1.1343652741332766;-1.3192400797987174;-1.6596667869031774;-2.3149141753687705;1.7595827184581563];
LW2_1 = [0.017767353071024165 0.57540525771568241 -0.058873556307115896 -0.61260616153194081 -0.53305503757947115 -1.4091700977536412 -0.36773873540666241 -0.48844410243049796 0.61549832711479424 1.3173319078796435 0.68652149049018429 0.28236774652129543 -0.42311418147403917 -0.33097534853090999 0.059923242537782501 -0.29060892366427454;0.029077695275225062 0.16404332544167144 -0.032992447806929164 0.66538863771700563 -0.10046118427840299 0.30427421862273302 -0.37845082547289655 -0.32178077247670639 0.0088769619535090678 -0.067943829715451556 -0.36247658907155117 0.43474388651557611 -0.34984218063480454 0.48957861261164642 0.75135110784085712 -0.0055870028213816716;-0.13870617793850956 0.26703177621815866 0.11775372237100939 -0.31389051544517921 0.5623365145566861 -0.22248933078989072 0.35848095854014578 -0.58018901840529691 -0.18888704161844239 0.11980995219916672 -0.17613159661906155 -0.40443997263143155 0.039271704331732084 -0.77437955067715858 0.1483072385136639 -0.80315784979720006;-0.18230487821393845 0.045059334929675648 -0.25964471992875432 0.88004392889816518 0.0054409005920044622 3.5163675799007539 -1.644849096823261 -1.093392403755393 -0.55032114045198199 -0.95069696395750536 -2.9773144403640894 -0.099318642896732048 -0.3345556524560081 0.58345033344499975 -0.2820582890207296 -0.33351567728682452;-0.41360350571574972 -0.46574097931168212 -0.26570124470445744 -0.13987932732668681 -0.15595986786873953 5.3477422548659108 1.0942084067571809 -0.54237144554442496 -0.90193612238522758 0.59153208986428707 0.060991867566604338 -0.50866845408338823 -0.86037234313552247 0.33067180103674765 -0.26331091627682957 0.72026648755197653;-0.57390427127382293 -0.40372577483538569 0.71012137371232131 -0.11944631071919225 0.35869317400349582 0.31123530449603454 -0.29366816661338363 0.53438583327746292 -0.72791694187080314 0.26849158813501139 -0.22783239083252954 0.068676186662676039 0.08450018075186419 -0.48689200092638524 -0.58631177932815126 -0.82569788768486829;-1.2373497512671663 0.41490507467400034 0.44377392979962094 -0.25106075318430682 0.18037785914151919 -2.3740404178526466 0.097802360466865773 -1.0994371874124975 -0.34601794534207092 -1.0932744125148384 2.306260829246269 -0.063218456888034152 -0.34306244954403153 -0.36963349457787031 0.38116627734109487 -0.61564478730067307;0.16540018843104115 -0.44193530362727457 -0.1299036870522893 0.14867929674693545 0.853087865617564 -0.95622958129014701 4.3750727047981606 5.2246789255452626 -2.4361286480360795 2.3334413580769588 2.2360406002236868 -0.19537769893537965 0.14327448541379287 -0.95519991613017696 0.11616650782167481 -0.36631105195808228;-0.39396389384899344 -0.056488615304224395 0.37823945349798205 0.87401855737904355 0.24847357828906316 0.90104260004659475 -1.8963423220902278 -2.5531535053369114 0.61365245521470535 -0.75263482946611993 -1.1002785455748985 0.78846423521461384 -0.33694465729029899 0.43421791120551168 0.98607328080466505 0.71760562243574488;-0.47773254997155723 -0.53546700751677934 0.66614944840885792 -0.57872958867902047 0.041298979408653583 -0.26924559723103825 -0.32465005504067651 0.23960620045002495 -0.58735309357887411 -0.2582442451001537 -0.47543436224732732 0.313218634629154 -0.08461971366638113 -0.52058473304403263 -0.26108954559689507 0.50087613943142673;0.47362700407315445 0.95384973631699199 -0.34914866838586961 -0.65346270775602644 -0.96282263910979171 0.84310276981503263 6.7413710997393359 3.0048600484560444 1.4746289033014803 -1.2834247160215337 10.020967971198983 1.1289095993743612 -0.97414872205396796 0.62458935465850585 0.47027371699956982 0.17704359851708321;-0.72505730662581924 -0.6776147940654883 0.60221023984198963 0.14603841264986445 -0.24350356552689645 -0.38130255740589064 0.44524129157034792 -0.17320410042228832 -0.17341600703730806 0.4996216033018655 0.14936507053846179 0.030383158553186813 -0.19021936140368875 -0.13626076769108483 0.17148178818880283 -0.7268808963468586;-0.58502418256792521 0.53348284930441336 -1.1625091499456275 -0.53659993418726482 -0.70320640087724662 -0.3626165408006865 -5.8287408053932248 -6.9026954600650638 3.2504656681559618 -2.6264629983249712 -1.8818043952572645 0.29923454986391768 -0.74736890182216287 -0.11807691022969047 0.8347283432231648 0.41809227699634532;-0.89621846098545621 0.34085860568901488 0.63089765372682871 -0.27176201058864863 -0.17240869940423345 -0.27814806214688054 0.56724580451162976 -0.10257202959148272 0.32609845954289962 0.049948455505410404 -0.23401419658336384 0.077153947365856582 -0.03659855168150325 -0.15363655550244668 0.11057790857006117 -0.30914249224655066;-0.54576761846332411 -0.53308820214621722 -0.27955788793179759 -0.18322762077260493 -0.14777801133003451 -2.6471073673461358 -1.7818231482509959 -1.4993785266184816 0.049698844639667478 0.83029254549269849 2.163289986167177 -0.315070410612659 -1.5463568566086539 0.24976927109860536 0.36877771136387816 0.0086429686526805043;0.41160803548537372 0.53770008910373168 -0.38324227036135955 0.26698663391669014 0.23654937361659245 -0.54714951186847449 -0.41352156010395985 -0.59727388301432383 0.58727351130739391 0.17654085558650712 0.48020944215832029 0.4018120699180372 0.16591199524356104 -0.23297833535557314 0.44739712598236098 -0.32958606339882646];

% Layer 3
b3 = -2.3838112246330727;
LW3_2 = [2.8163552808883483 -3.1246735982096792 2.9699489827320176 -5.3940587791002805 -5.0603863539634908 2.6474033709661517 3.9254979770241079 -6.4044870820666029 2.3266963958323026 1.1047235466968151 12.178014267754715 2.8182370777653509 8.5638026206179401 2.4832736831515105 4.8279668451093141 -2.2623853303826915];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = logsig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Output 1
    Y{1,ts} = a3;
end



% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
temp=cell(1,TS);
temp=gnegate(Y);
Y=temp;
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n,~)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end
