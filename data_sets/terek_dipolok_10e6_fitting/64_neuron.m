function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 07-Mar-2017 13:00:33.
% 
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 4xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 4xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-10;-10;-10;-10];
x1_step1.gain = [0.1;0.1;0.1;0.1];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.9027227592558402;0.82400143636266043;-3.8589381449478104;-1.2570507223847989;-1.6065165843229381;3.0029729277749042;0.09204584241601331;-1.686794845688526;-1.4669017273545379;1.3313700250419893;-0.43059160993584716;-0.63341147572820822;-2.2305557015167135;1.8124232214747249;1.8767782601376615;-2.004419723482747;-1.4016166357142454;-2.1275072813731586;-0.19348222363624956;-0.87238720933100566;-0.11691967676085746;0.96764754214273241;-0.076850478877979939;-0.10451804747771874;-0.024827405535535457;-0.7465606969820906;-0.42774179971470405;-0.60916433120328883;-0.065058879059823035;0.16208751250107253;0.024330691118636477;0.23245595347118259;-0.49883859798487917;0.088167571413469412;0.0053565157490457847;-0.0033469079956002538;-0.048347894685037349;-0.17296296517797327;-0.29537681144967359;0.51222771059198702;-0.19208564717435156;-1.1649839552710644;0.84287241004215041;0.16215508707590306;1.9397024944978598;-0.85228188109380565;0.86300183632625838;-1.2543214517240175;-2.0803869089119038;1.0629069883470199;1.0213632415549421;-2.1836384980281514;2.2729409602948749;2.1199096931884687;2.1906180802815425;-2.9085325680254628;1.9285439311829704;3.1212776192063094;-2.2861894666207965;-0.89309525552602476;-3.0004483967533471;2.2270223010308881;0.52711716469930725;-2.5341450642731407];
IW1_1 = [0.021520767671921744 -2.848159791916038 -2.4651704883952963 -0.00067256561756515133;-0.77139758742107944 0.00048659098061548802 0.01219022578273771 0.036962532741862272;0.091214378144614361 -1.761861863651988 -0.085796482269143895 -2.0284060127943069;0.034987341736739869 0.0074532080252813597 -1.4812701034917328 -0.039079676595844319;-0.024821299766711089 1.2740186977394485 -0.016715138269892526 1.0085091654951281;-0.90840870908431104 -1.9493519468985046 2.1123592897454948 1.0727755612866046;0.011752894488898201 2.1678379795078624 0.56577813361297113 0.26450676826543729;-0.0025450060369971001 -1.4865018750238335 -1.4575100600253097 0.031713297878075045;0.098236166897790231 0.53657793182024016 -0.0337928657262766 -0.78366201325132456;-0.011807935933706002 -0.071590826013027561 0.014575484023695134 1.4861165123897617;-0.028321949334450217 0.017254621487556042 -0.13466521647748314 0.010232839792354322;0.00046197176238408141 -0.69919583026362742 0.012832874927921881 0.023242778064996108;1.7900709015927116 -1.952997081688659 1.6980607235141023 1.3688925179530973;-0.7358017525888868 1.382794810907652 -1.3282219374040443 1.4861819719911713;-0.13697948049015329 -0.032668243421154743 -2.3570874730024713 0.027891312960869181;0.88786803838114003 -2.0647103860409981 -1.697164483538987 -1.4451658256602178;0.8113755401223931 2.1729731142244182 1.5682693672620085 2.1468394717280921;1.6135362555576094 1.6510335318496572 -1.4006133621660113 -0.21315455957585958;2.0566064897467942 0.0015786724937580166 0.39477938542026197 -0.017049054750268355;3.186245477018633 0.0014566987984003024 0.35520291798367154 0.001667105986664498;-1.3520933287939025 0.008114381016361482 2.5035278110173587 -0.0071173099962165715;-2.2700543945448222 3.1330506859860208 -0.21606319935341173 0.41016553996813088;-4.4101093224834127 0.00015300859129742861 0.067050892269227377 1.6259370359705645;0.0076037073435373474 -1.466719905926227 2.214186848202405 0.014119903821706272;-0.0019234710598473616 6.9095600442205205 0.13447921921229961 0.082424769474931062;2.3461151726713436 -1.0607688975240095 0.95338244148826989 2.3648507229996536;1.5038662410375718 1.7660529092422474 -1.2457267141998778 0.32595814610650853;0.52287614460397946 0.43204257346067293 -0.08085464975586433 -1.6265622244785742;0.003998446758108694 -5.4194174884325523 1.357511130934284 0.022025879714806854;-0.43246622982216726 1.5329034508694792 1.0734824409520816 -2.1477861017361946;0.0017172337114231423 -6.8642536567836716 -0.080215652509541074 -0.15385790245009892;-2.146381879280475 0.0024170691138998392 0.70210020680771812 0.015890601100638533;2.5983845028862316 -0.0017457006304483543 -0.93920244150944099 -0.012735847464035794;-0.0048598229058071955 4.9171671611542056 -0.0086242799063497282 -1.371302016057768;0.0013756585107091578 -7.878826182830112 0.22820195915980671 0.13726912434305963;9.1308055943804316 -0.00035807305819869872 -0.31045621049659761 -0.2137581239474784;7.5337011521459392 -0.00052262847660969585 -0.16427012675720851 0.6095973611163179;0.63969558040150587 -0.0013455981104633901 0.011919535039885127 3.0136173858156119;-2.646717923708235 1.7492855184479039 0.81691903821040346 -0.35620127996660805;1.9007262799338456 2.6919939489490337 0.42763887722671706 0.47130912701959393;0.0076418344874071798 -1.1008849368877678 -0.010993016627859994 1.8952690932418768;-0.62332344054620425 -2.5257255867200135 2.657550854458897 -0.95432819604677577;1.8531106930255445 0.92237649428408397 1.5144034749132389 1.3559917176485916;1.8038049485791248 0.0020545528338810353 0.014257834772373823 -2.4089703145792272;3.1819670931611967 -0.0048672337189688015 0.065798734126527397 2.3956393312143121;-0.00083455169721052174 1.2080678401732641 -0.021659642461261598 -0.034060175470954884;3.4154482289405923 0.0020796859747485353 0.27807840593620742 0.034118976926583215;-1.8374144163671049 2.090862912149682 -1.3874469110359526 0.30931839891549229;-0.90727051863747998 -1.8812004833790503 0.95358783244896561 -1.7539547833593281;1.1474698484180232 1.0559126348275354 -1.2569037726290813 -0.25094688289619577;3.7228711664684533 0.013067002819319043 -1.572867166176531 0.021464817970341249;-0.061538626578775076 2.5932154915906516 -1.1527166451488666 -0.019015980573494747;2.7055187612167995 -1.759665868822708 -0.19479765830744591 -1.2470176078463002;1.673935097512264 0.73785139211877893 2.3439983164192966 -2.3208850033052606;1.0397025886141655 0.91325090436695988 0.32890597920255166 1.2392286388820215;-1.4370106186151372 -0.017626812370677588 1.6019196464454788 0.04997330484562023;3.7542202655336276 0.13370115706797134 1.3878788982129475 -0.21451734735706621;3.2685279589205254 -1.184033645291602 -1.8943137640348848 -0.58235827370146653;-0.050141028297430307 -1.2059082748619798 0.0042325404411434984 1.8171532393205037;-0.84450088613149965 0.00060182802763656318 0.015238846774100263 0.032086951709422995;-0.2458720909191405 1.2982027074376945 -1.7299521781451905 1.4853129318876894;1.3448577140436255 0.017692204396930769 -0.0024187113135611506 1.4587704383272018;-0.073031673883012349 0.0032320404015686341 0.00083182121730079764 0.10436066334033961;0.0011597578048382702 1.5852254519622853 -0.032014357474647072 -0.041581060899844327];

% Layer 2
b2 = [0.077338961646292309;0.028900190884407713;0.42287187163259787;0.073766426822957226];
LW2_1 = [-0.00036319619801342508 -1.0410731302856502 -4.900840622079372e-05 0.011882457165810397 0.00040120499458381331 0.0001938275420082374 0.00015141539801638709 0.0006589506107650793 0.00021406091572025941 -0.0027433126567081123 0.60338216106658726 0.011049534940125711 -1.3551056794267553e-05 2.6685446839490576e-05 0.012856792952556999 1.8831292052806538e-06 1.9936006198890712e-05 -0.00014846334818118011 0.1146142559924935 -0.050898175693674524 -0.0098536023097322845 -5.2473891222598898e-05 -0.00066456713084054545 0.00033933222029429146 0.00032007094864134705 2.3068079314328254e-05 1.1512405473297026e-05 -3.9929944949031095e-05 0.00014516727754517695 -1.3835441941667543e-05 0.00050304373639044309 -0.14720159943219188 -0.080399639548339855 -0.00011066966185539084 -0.00019248510926873699 -0.014770753529348804 -0.004077319555434787 -0.00051231682079903244 5.0528118368954132e-05 -0.00010191659696281003 -4.9629632218112628e-05 -7.7839090240826592e-06 -3.0597353766850306e-05 -2.8549189110663141e-05 -0.00023947655874853355 -0.0040386058328319126 -0.027693377905806997 -0.00011060826922989257 -8.8755947550991206e-06 0.00021382619586713284 -0.0099045834287671344 -0.00050775667302356043 4.7726450204802159e-05 -2.7369852344663994e-05 -0.00046073497935534608 0.0037452312236051044 0.0016085571207015265 0.00024464254466055379 0.00015793358359900492 -0.93211197696601045 -0.00022720895782654728 -0.0014278282159203579 0.46106860926820253 -0.0028704411520103692;0.0041633094461616671 -0.035369559134804975 0.0001647617321693336 0.0074995590436780944 0.0012721830751560234 -0.0003174839255285097 0.0040036408947324844 0.010634652768231792 0.0079918740827404806 0.0011224763077397515 0.52997205496763611 -1.2277777217779535 9.5117646624717178e-06 -7.1232591391318944e-05 0.010912575799855195 8.0346184721641188e-06 7.4955844837141478e-05 1.9481934463390584e-05 -0.0011957651996900281 0.001116659748938139 0.00054208349682771889 -2.3081479539761905e-05 -1.3027502598735904e-05 -0.012530726579795088 0.16062937742445368 7.3908263230158507e-05 0.00016722532989992903 0.00078798546446266575 -0.016096143235287044 5.818307967122587e-05 0.12666961328791476 0.001633455669378563 0.0012985902856452415 0.00085822967965657002 0.045086323630540645 2.7239420930418259e-05 0.00020624258677943749 0.00036152957520862024 2.3993659505166606e-05 4.7527917294064533e-05 0.00033149059910325435 -0.00021297947169330174 0.0001462265402531506 6.8614056223074242e-06 0.00021642449439213623 0.39390062792765684 0.00095119233917936321 -0.00012845096586202497 -0.00017391095393467812 -4.5916888748251438e-05 0.00024438318162729278 0.0020371441056044395 -8.2039770672906803e-05 4.4050519649154605e-05 0.00075388105494486612 0.00050203548854394376 -8.6543342509516071e-05 -6.4106753266479763e-05 0.0020505773727759252 -0.027752018353812163 -0.00028674472631231608 0.001171455977100866 0.29402782083879075 0.36065129602091645;1.1214821568279169e-05 -0.9825001528888283 0.00059762009889906319 0.00087331206325878157 0.0011882915030493231 -4.8350442023969628e-05 -2.2091359918671007e-05 -5.2579102917271635e-05 0.0067284894713100212 0.021480028655178156 -0.13981633807054092 -0.0075465795512104205 -7.3931065713728764e-05 -0.00011872796588084285 -0.00049972472229410148 3.2839472264552052e-05 1.5726030084974542e-05 3.7047189499884398e-05 -0.019154501854958459 0.018826284964614026 0.00021691290288564194 -2.4636556253419634e-05 -0.010495733707513104 -6.7399470181322448e-05 -0.0010238136263018345 -4.8975036380320141e-05 2.5322865059469098e-05 0.00089978558874070501 -7.081106141989758e-06 3.9223403272344926e-06 -0.0011501145654058509 -0.0061659936375043868 -0.0017302170048789194 1.6116868586663243e-05 0.00010723198043207699 -0.02191190564861541 0.018602624772847205 0.0060980419306027071 -3.5044587352766323e-05 -1.2992622064781876e-05 0.00055390873536328587 -2.9439711331697352e-05 0.00021871829784141718 0.0076784612905022196 -0.0033237689324313929 0.00087270875162603196 0.014601225125337776 -5.5988757770682716e-05 7.8054220770361626e-06 -4.2389395700414977e-05 -4.7525224904952372e-05 9.2103820837592852e-05 -3.2638560625275961e-05 3.5880353602720254e-05 0.00081576172826541902 0.00049930527372087151 6.5160341817997849e-05 -3.8422642093933394e-05 0.0011710493255985032 -0.88516577760711501 0.00017062807544184004 -0.018025893889839651 -0.90228190201700353 -0.00023463010752508602;-0.00033755684517402352 0.030171333477778312 -0.0107418521678188 0.0015604353025415853 -0.036555017989922202 0.00023492499832472699 0.0024036873822116393 -0.00098750308125761179 -0.051194049001783239 -0.039752275078839182 -0.14147998974790554 -1.2133989567588426 -1.7647753354645138e-05 -0.00017535213205243576 -0.00044805851350959003 -2.278252822272294e-06 2.9077330998811303e-05 0.00017064442646617825 0.00012498973698913228 -0.00037601709123197681 -8.7935509821766297e-05 0.00010528274724943721 6.2373072628858935e-05 4.2105318603266325e-06 -0.16730429402709271 -7.7403468899162788e-05 6.3996204978860574e-05 -0.0010727259820882916 -0.0011884465671401559 -8.6422326630000167e-05 -0.19210022027998933 0.00053286970043657424 0.00017725618276403832 0.015378715622849133 0.033102008442159887 -7.3849741519055919e-05 1.6114765511493254e-05 0.00077163741329702045 -0.00013491619128989474 -0.00015566744189286877 -0.019599913779013146 -9.5793737126899676e-05 -0.00022386434516351522 -0.00027407346804638605 9.2218447224882267e-05 0.42606612573848707 -0.00041689094103003314 6.8010781289304988e-05 0.00068655246287475328 0.00010254697135204934 2.3624683384524184e-05 -0.00044294956534533662 -9.4291954567531054e-05 -4.5557820640011299e-05 -0.0022684317212206665 -0.00025036967968518933 6.0714949594261854e-05 9.8409435818418815e-05 -0.016311631034036548 0.023634772541445904 -0.00011763067771933158 0.0014839612080968846 -0.41475229301030575 0.3988182694702963];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.000587457776472316;0.000587663186721163;0.000587342188495729;0.000587071511180777];
y1_step1.xoffset = [-1796.72;-1795.1;-1795.87;-1797.09];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
